<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">






  <link rel="canonical" href="http://yoursite.com/page/6/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/leetCode题库笔记/17.电话号码的字母组合/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/05/leetCode题库笔记/17.电话号码的字母组合/" class="post-title-link" itemprop="url">17.电话号码的字母组合</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-05 20:02:12" itemprop="dateCreated datePublished" datetime="2018-07-05T20:02:12+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 15:17:30" itemprop="dateModified" datetime="2018-12-26T15:17:30+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/leetCode题库笔记/" itemprop="url" rel="index"><span itemprop="name">leetCode题库笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#一、题目原型：</p>
<blockquote>
<p>给定一个仅包含数字 2-9 的字符串，返回所有它能表示的字母组合。<br>给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母。</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/1869467-0cb3d33198ad2914.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="电话按键"></p>
<p>#二、题目意思剖析：<br>其实呢就是一个排列组合，将字母按照有序的顺序组合起来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    2-abc</span><br><span class="line">    3-def</span><br><span class="line">    4-ghi</span><br><span class="line">    5-jkl</span><br><span class="line">    6-mno</span><br><span class="line">    7-pqrs</span><br><span class="line">    8-tuv</span><br><span class="line">    9-wxyz</span><br><span class="line"> </span><br><span class="line">   输入：&quot;23&quot;</span><br><span class="line">   输出：[&quot;ad&quot;, &quot;ae&quot;, &quot;af&quot;, &quot;bd&quot;, &quot;be&quot;, &quot;bf&quot;, &quot;cd&quot;, &quot;ce&quot;, &quot;cf&quot;].</span><br><span class="line">   如果输入的是 245</span><br><span class="line">   输出：[&quot;agj&quot;, &quot;agk&quot;, &quot;agl&quot;, &quot;ahj&quot;, &quot;ahk&quot;, &quot;ahl&quot;, &quot;aij&quot;, &quot;aik&quot;, &quot;ail&quot;......</span><br><span class="line"> */</span><br></pre></td></tr></table></figure></p>
<p>#三、解题思路：<br>我呢是用swift语法来做，但是逻辑思路都是相通的。<br>第一想到的应该是递归。通过递归，再加上一些判断条件，将对应的字符串加入进数组。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 1.最外围的主方法</span><br><span class="line">func letterCombinations(_ digits: String) -&gt; [String] &#123;</span><br><span class="line">    if digits.isEmpty &#123;</span><br><span class="line">        return []</span><br><span class="line">    &#125;</span><br><span class="line">    //  由于swift语法特性，需要将digits字符串包装为一个数组</span><br><span class="line">    var strings: [String] = []</span><br><span class="line">    for digit in digits &#123;</span><br><span class="line">        let str: String = String.init(digit)</span><br><span class="line">        strings .append(str)</span><br><span class="line">    &#125;</span><br><span class="line">    haha(strings,0)</span><br><span class="line">    return result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">// 2.核心代码实现</span><br><span class="line">func haha(_ strings: [String], _ index: Int) &#123;</span><br><span class="line">    if str.count == strings.count &#123;</span><br><span class="line">        result .append(str)</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    // 防止数组越界</span><br><span class="line">    if index &gt;= strings.count &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    // 1.首先我们需要一个电话号码base数组。</span><br><span class="line">    let bases: [[String]] = [[&quot;&quot;],[&quot;&quot;],[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;],[&quot;d&quot;,&quot;e&quot;,&quot;f&quot;],[&quot;g&quot;,&quot;h&quot;,&quot;i&quot;],[&quot;j&quot;,&quot;k&quot;,&quot;l&quot;],[&quot;m&quot;,&quot;n&quot;,&quot;o&quot;],[&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;],[&quot;t&quot;,&quot;u&quot;,&quot;v&quot;],[&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;]]</span><br><span class="line">    // 2.通过index索引将strings对应的字符串元素转换为Int类型的索引</span><br><span class="line">    // baseIndex : 电话号码(数字)索引,比如strings=[&quot;2&quot;,&quot;4&quot;,&quot;5&quot;],baseIndex就是2,4,5</span><br><span class="line">    let baseIndex: Int = (Int)(strings[index])!</span><br><span class="line">    for i in 0..&lt;bases[baseIndex].count &#123;</span><br><span class="line">        // 拿到子数组里对应的字母</span><br><span class="line">        let baseStr: String = bases[baseIndex][i]</span><br><span class="line">        // 1.如果当前正在添加第一个字母,就将str清空</span><br><span class="line">        if index == 0 &#123;</span><br><span class="line">            str .removeAll()</span><br><span class="line">        &#125;</span><br><span class="line">        /* 2.如果当前正在添加最后一个字母,并且不是第一个字母串,就删除str的最后一个字符</span><br><span class="line">             比如index = 2,说明在添加第三个字母，如果i不等于0，就需要把最后一个字母删除。</span><br><span class="line">             &quot;agj&quot;, &quot;agk&quot;, &quot;agl&quot;</span><br><span class="line">             过程 : agj - ag - agk - ag - agl</span><br><span class="line">         */</span><br><span class="line">        else if index == strings.count - 1 &amp;&amp; i != 0&#123;</span><br><span class="line">            str .removeLast()</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // 3.如果str不为空，需要删除字母串的后面几位，通过index来设定</span><br><span class="line">            // 用str的长度 - index得到后面需要删除的长度</span><br><span class="line">            // &quot;jmpt&quot;, &quot;jmpu&quot;, &quot;jmpv&quot;, &quot;jmqt&quot;, &quot;jmqu&quot;, &quot;jmqv&quot;, &quot;jmrt&quot;, &quot;jmru&quot;, &quot;jmrv&quot;, &quot;jmst&quot;, &quot;jmsu&quot;, &quot;jmsv</span><br><span class="line">            </span><br><span class="line">            // 比如当前字符串为 jmrv，index为2，就需要删除后面 4 - 2 = 2，删除后面2位。</span><br><span class="line">            // baseStr为s，然后接下来的baseStr为t。</span><br><span class="line">            // 过程 : jmrv - jm - jms - jmst</span><br><span class="line">            if !str.isEmpty &#123;</span><br><span class="line">                str .removeLast(str.count - index)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        str .append(baseStr)</span><br><span class="line">        haha(strings, index + 1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#四、小结<br>有时候这类题都是去找规律，我们需要把一些例子所得到的数据展示出来，然后去寻找规律，让计算的过程直观的表达出来。<br>注：可以在haha方法里加入一个indexs数组，result也不要限定条件来添加，然后直接在letterCombinations方法里打印出indexs和result的值。这样可以非常直观的查看添加过程。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func haha(_ strings: [String], _ index: Int) &#123;</span><br><span class="line">    indexs .append(index)</span><br><span class="line">    result .append(str)</span><br><span class="line">    、、、后面的代码不变</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://upload-images.jianshu.io/upload_images/1869467-699c02b94608c237.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="总提交数.png"><br><img src="https://upload-images.jianshu.io/upload_images/1869467-424a9f5580170199.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="提交结果.png"></p>
<p>有任何疑问都可以留言，非常乐意一起探讨。😄</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/11/旅行/东西涌穿越官方攻略/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/11/旅行/东西涌穿越官方攻略/" class="post-title-link" itemprop="url">东西涌穿越官方攻略</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-11 10:38:12" itemprop="dateCreated datePublished" datetime="2018-06-11T10:38:12+08:00">2018-06-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 15:33:59" itemprop="dateModified" datetime="2018-12-26T15:33:59+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/旅行/" itemprop="url" rel="index"><span itemprop="name">旅行</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##一、收拾行囊(物品准备)<br>时间：最好在出发的前一天晚上准备好<br>装备：<br>1、穿戴： 帽子、头巾(围脖、护脸多功能使用)、护臂(直接淘宝搜护肘护臂)、手套(防滑的就行)、太阳镜(可以考虑带，很帅)、衣服带两套(长裤一条、短袖两件)、运动鞋一双、拖鞋一双(可以考虑带)、泳裤一条、沙滩裤(短裤)一条、不会游泳的那边有泳圈租10元一个、一把伞(防晒、防雨)<br>2、药品：扭伤药系列(防止有人意外扭伤，及时处理)、花露水(要穿越树林和一些茂密的草丛，驱蚊止痒)、然后防晒霜啥的(男孩子就别带了，做好上面的穿戴就没事)。<br>3、吃喝：1袋面包(不需要太多，5个就够了)、4个煌上煌鸭架(补充盐分)、4根黄瓜(4根真的不多，你相信那几根黄瓜是我吃过最好吃的黄瓜吗)、2瓶2元怡宝水、1瓶盐水 (注–以上说的吃喝，是一个人的分量哦，水最好都带冰的，解渴)<br>4、报备：可以提前在<a href="https://dp.coolcar365.com/wtt/home/outing/outing?from=singlemessage&amp;isappinstalled=0" target="_blank" rel="noopener">网上报备</a>，也可以现场报备，其实就是登记一下。</p>
<p>差不多就这些，如果还有遗漏的，再及时补充。</p>
<p>##二、出发<br>起点：早上5点半起床，洗漱收拾东西差不多10-15分钟，5:45在楼下直接拦了辆车（早上出租车还是挺多的），几分钟就到了深圳北站交通枢纽公交站。问了下路，坐E11路是在二楼。差不多在6点前就到了，这时是可以赶上第一班的。不过我那朋友迟到了，最后我们坐的6点半那车。<br>定位目的地技巧：直接在百度地图搜索E11路，直接会有一个起点终点，找到深圳北站交通枢纽公交站，点击然后点击到这去，直接导航。从我民乐新村(地铁4号线民乐站附近)这到那边不到五公里，开车花了10分钟不到。<br><img src="https://upload-images.jianshu.io/upload_images/1869467-b325248dc0872e3f.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="起点.JPG"></p>
<p>坐车：坐E11到 (南澳街道办站) 下车，然后在南澳街道办站等车。<br>1.如果你要去东涌，就做M231，到终点站东涌浴场下车；<br>2.如果去西涌，就做M232，到西涌三四号浴场下车（其实后面那几站都行，西涌海岸线简直太美了，又比较长，到哪下都行，不要去终点站西涌西贡村就行。）<br>坐车时间：6点半上车，8点25到南澳街道办，南澳街道办坐车到东涌/西冲大概20-30分钟。总体时间：2个半小时左右。<br>ps：最好下一个叫做“车来了”的app，这样方便很多。</p>
<p>##三、路线建议：东涌 到 西涌<br>到了南澳街道办，就直接坐M231去东涌。不要进去东涌浴场，切记切记！！！那里完全和西涌浴场没法比，只有西涌海岸线长的四分之一可能更少，价格却是20元一人，西涌是13。<br>到了终点站，直接下车往东涌码头走，那边有一座桥，百度地图没更新，大概在这个位置。<br><img src="https://upload-images.jianshu.io/upload_images/1869467-31bf4e249e29ad56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="东涌码头.png"></p>
<p>桥的那边会有人守着，你需要登记一下(报备)。<br>过桥沿着土路（能容纳一辆车的路）一直走，看到一个小亭子(铁皮房)，里面有人吹着空调(可能也不在)，不用管他。直接往左转上山，此时沿着路走你就开始穿越啦。</p>
<p>##四、正式穿越<br>时间控制：穿越时间3小时<br>穿越时间一般在3-5小时之间。我们是两个人(男孩)，行动力比较强，从报备登记完到目的地差不多花了3个小时，包括了中间休息的时间。中间休息大概在8-10次，每次3-5分钟，如果坚持不了，就找一个就近的地方休息，最好是有遮阴的地方。喝口水、多做深呼吸，慢慢走不要急。<br>路就一直跟着海岸线走就行了，有些很陡峭，有些很平坦，在岩石上跳来跳去要小心，不要扭到脚，注意安全，如果队伍里有女生，最好有几个男孩子带着，慢慢走。放几张图，你们感受下。<br><img src="https://upload-images.jianshu.io/upload_images/1869467-3c1aef4f370e7d38.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="山石"><br><img src="https://upload-images.jianshu.io/upload_images/1869467-5421086276cdc6ff.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="峭壁"><br>有些困难，这样就会有挑战性，人活着就需要做一些自己不一定能完全做好的事，这样才会有意义，这段记忆会一直存储在你的记忆里，经久不息。</p>
<p>##五、东西涌路线选择<br>1、东西冲穿越：如果你要爬山穿越（很苦的，脚会很酸，有些地方很陡峭，要注意安全），累但是很有意义。<br>2、如果不穿越，单纯的是想去海边玩玩，看看干净的海水，看看日出，踩着沙子看着心爱的人的笑容，那就完全可以直接坐M232去西涌。(海边小屋我问了，双人床一晚238，两张床一晚338，需要电话的话留言，我不是打广告的坚决不是，因为那个要提前预定，火爆期真的怕订不到。也可以自己带帐篷，在那搭着睡)<br>西涌是真的好看，好几公里的海岸线，延绵无尽。海水清澈见底，沙子柔软，你可以光着脚踩着沙子慢慢走，也可以租一个太阳伞在那躺着坐着，一天感觉就会过得很缓慢，听着海浪的拍打声，陪着自己的家人开开心心的，一切就真的很美好，其实这就是幸福生活了吧。也是自己一个人偶尔放松放松、放空自己的非常好的去处。<br>额，我不会游泳，怕吃海水，太特么咸了，学了很久也不会。<br>喜欢游泳的在那呆上两天，你就知道那简直就是天堂。<br><img src="https://upload-images.jianshu.io/upload_images/1869467-25fc26c7dd88f55f.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="沙滩"></p>
<p>————————————我是分割线——————————————————</p>
<p>前段时间家里人来深圳玩，我又去了一趟西冲，路线大致相同但也有些不同，再次分享下。</p>
<p>1.起点还是<code>深圳北</code>，时间是接近中午的时候。这次因为带着家人路途遥远，我们就在<code>大棚中心站</code>下的车，补充了能量吃了个午饭。在那公交站附近有一个华润万家超市，我们把很多多余的背包都存放在那了，免费的，你就说去买东西等下来拿😄。</p>
<p>2.然后坐<code>M232</code>，直接到达<code>西冲一号浴场</code>。然后租了几个游泳圈就过去了。然后发现人炒鸡多。。。这个时候是下午不到4点的时候。当然，海水依旧清澈，旁边时不时有人坐快艇过，一浪接一浪。有人冲浪、有人潜水。</p>
<p>3.然后我妈妈不打算住宿，我们玩了几个小时就打道回府了。差不多6点钟开始出发，折回大棚中心，取东西，然后等<code>E11</code>，8点半到了家，之后当然就是丰盛的晚餐咯。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/08/iOS随笔/iOS瀑布流之横-纵瀑布流/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/08/iOS随笔/iOS瀑布流之横-纵瀑布流/" class="post-title-link" itemprop="url">iOS瀑布流之横-纵瀑布流</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-08 10:16:12" itemprop="dateCreated datePublished" datetime="2018-06-08T10:16:12+08:00">2018-06-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:56:48" itemprop="dateModified" datetime="2018-12-26T14:56:48+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#一、开篇</p>
<p>####1.瀑布流设计讨论<br>1.应用场景：在我们app开发中，瀑布流一般应用于大数据展示时，比如淘宝搜索页面、蘑菇街app、各大直播app主播列表页面等等。</p>
<p>2.设计思路：我们首要考虑UICollectionView,因为UICollectionView特殊性和可复用性。因为瀑布流每个格子item大小不同，需要计算每个item的宽高，就需要自定义UICollectionViewLayout。</p>
<p>####2.瀑布流分类<br>我把瀑布流分为两种：垂直瀑布流、水平瀑布流。</p>
<p>1.垂直瀑布流：在我们app上实现的瀑布流一般是垂直瀑布流，也就是列数可设定，item宽度由列数决定，从上往下布局。</p>
<p>2.水平瀑布流：我在搜索网页百度图片时，看到百度图片的布局从而想到的一种布局方式。每行的高度是可设定的，item高度由图片大小决定，比例缩放。</p>
<p>####3.瀑布流样式展示<br><img src="https://upload-images.jianshu.io/upload_images/1869467-06e7c4b154b9f2ac.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="垂直瀑布.jpeg"><br><img src="https://upload-images.jianshu.io/upload_images/1869467-02a5fe8096cbcf84.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="水平瀑布.jpeg"></p>
<p>#二、具体实现</p>
<p>####1.创建一个UICollectionViewCell，它上面只有一个imageView。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// CollectionViewCell.m</span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    </span><br><span class="line">    if (self = [super initWithFrame:frame]) &#123;</span><br><span class="line">        _imageView = [[UIImageView alloc] init];</span><br><span class="line">        _imageView.frame = self.bounds;</span><br><span class="line">        [self addSubview:_imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>####2.我们需要自定义一个layout，并且暴露一些可设置的属性用来控制瀑布流的对应展示，让瀑布流可用性更强大一些。</p>
<p>######2.1 头文件：DYTWaterflowLayout.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">@interface DYTWaterflowLayout : UICollectionViewLayout</span><br><span class="line">/**</span><br><span class="line"> *  行高(水平瀑布流时),默认为100</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign) CGFloat rowHeight;</span><br><span class="line">/**</span><br><span class="line"> *  单元格宽度(垂直瀑布流时)</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign, readonly) CGFloat itemWidth;</span><br><span class="line">/**</span><br><span class="line"> *  列数 : 默认为3</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign) NSInteger numberOfColumns;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  内边距 : 每一列之间的间距 (top, left, bottom, right)默认为&#123;10, 10, 10, 10&#125;;</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign) UIEdgeInsets insets;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  每一行之间的间距 : 默认为10</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign) CGFloat rowGap;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  每一列之间的间距 : 默认为10</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign) CGFloat columnGap;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  高度数组 : 存储所有item的高度</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, strong) NSArray *itemHeights;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  宽度数组 : 存储所有item的宽度</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, strong) NSArray *itemWidths;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  瀑布流类型 : 分为水平瀑布流 和 垂直瀑布流</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic, assign) DirectionType type;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>######2.2 .m文件：DYTWaterflowLayout.m属性声明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@interface DYTWaterflowLayout()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSMutableArray *itemAttributes; // 存放每个cell的布局属性</span><br><span class="line"></span><br><span class="line">// 垂直瀑布流相关属性</span><br><span class="line">@property (nonatomic, strong) NSMutableArray *columnsHeights; // 每一列的高度(count=多少列)</span><br><span class="line">@property (nonatomic, assign) CGFloat maxHeight; // 最长列的高度(最大高度)</span><br><span class="line">@property (nonatomic, assign) CGFloat minHeight; // 最短列的高度(最低高度)</span><br><span class="line">@property (nonatomic, assign) NSInteger minIndex; // 最短列的下标</span><br><span class="line">@property (nonatomic, assign) NSInteger maxIndex; // 最长列的下标</span><br><span class="line"></span><br><span class="line">// 水平瀑布流相关属性</span><br><span class="line">@property (nonatomic, strong) NSMutableArray *columnsWidths; // 每一行的宽度(count不确定)</span><br><span class="line">@property (nonatomic, assign) NSInteger tempItemX; // 临时x : 用来计算每个cell的x值</span><br><span class="line">@property (nonatomic, assign) NSInteger maxRowIndex; //最大行</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>######2.3 .m文件：DYTWaterflowLayout.m主要方法实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">// </span><br><span class="line">#pragma mark -- 系统内部方法</span><br><span class="line">/**</span><br><span class="line"> *  重写父类布局</span><br><span class="line"> */</span><br><span class="line">- (void)prepareLayout &#123;</span><br><span class="line">    </span><br><span class="line">    [super prepareLayout];</span><br><span class="line">    // (水平瀑布流时)重置最大行</span><br><span class="line">    if ((self.type == HorizontalType)) &#123;</span><br><span class="line">        self.maxRowIndex = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.type == VerticalType) &#123;</span><br><span class="line">        // (垂直瀑布流时)重置每一列的高度</span><br><span class="line">        [self.columnsHeights removeAllObjects];</span><br><span class="line">        for (NSUInteger i = 0; i &lt; self.numberOfColumns; i++) &#123;</span><br><span class="line">            [self.columnsHeights addObject:@(self.insets.top)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 计算所有cell的布局属性</span><br><span class="line">    [self.itemAttributes removeAllObjects];</span><br><span class="line">    NSUInteger itemCount = [self.collectionView numberOfItemsInSection:0];</span><br><span class="line">    self.tempItemX = self.insets.left;</span><br><span class="line">    for (NSUInteger i = 0; i &lt; itemCount; ++i) &#123;</span><br><span class="line">        NSIndexPath *indexPath = [NSIndexPath indexPathForItem:i inSection:0];</span><br><span class="line">        if (self.type == VerticalType) &#123;</span><br><span class="line">            [self setVerticalFrame:indexPath];</span><br><span class="line">        &#125;else if ((self.type == HorizontalType))&#123;</span><br><span class="line">            [self setHorizontalFrame:indexPath];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  水平瀑布：设置每一个attrs的frame，并加入数组中</span><br><span class="line"> */</span><br><span class="line">- (void)setHorizontalFrame:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    UICollectionViewLayoutAttributes *attrs = [UICollectionViewLayoutAttributes layoutAttributesForCellWithIndexPath:indexPath];</span><br><span class="line">    CGFloat w = [self.itemWidths[indexPath.item] floatValue];</span><br><span class="line">    CGFloat width = w + self.columnGap;</span><br><span class="line">    CGFloat h = (self.rowHeight == 0) ? 100 : self.rowHeight;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     *  如果当前的x值+当前cell的宽度 超出了 屏幕宽度，那么就要换行了。</span><br><span class="line">     *  换行操作 : 最大行+1，tempItemX重置为10(self.insets.left)。</span><br><span class="line">     */</span><br><span class="line">    if (self.tempItemX + w &gt; [UIScreen mainScreen].bounds.size.width) &#123;</span><br><span class="line">        self.maxRowIndex++;</span><br><span class="line">        self.tempItemX = self.insets.left;</span><br><span class="line">    &#125;</span><br><span class="line">    CGFloat x = self.tempItemX;</span><br><span class="line">    CGFloat y = self.insets.top + self.maxRowIndex * (h + self.rowGap);</span><br><span class="line">    attrs.frame = CGRectMake(x, y, w, h);</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 注：1.cell的宽度和高度算起来比较简单 : 宽度由外部传进来，高度固定为rowHeight(默认为100)。</span><br><span class="line">     *    2.cell的x : 通过tempItemX算好了。</span><br><span class="line">     *    3.cell的y : minHeight最短列的高度，也就是最低高度，作为当前cell的起始y，当然要加上行之间的间隙。</span><br><span class="line">     */</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;%@&quot;,NSStringFromCGRect(attrs.frame));</span><br><span class="line">    [self.itemAttributes addObject:attrs];</span><br><span class="line">    self.tempItemX += width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  垂直瀑布：设置每一个attrs的frame，并加入数组中</span><br><span class="line"> */</span><br><span class="line">- (void)setVerticalFrame:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    UICollectionViewLayoutAttributes *attrs = [UICollectionViewLayoutAttributes layoutAttributesForCellWithIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    // cell的frame</span><br><span class="line">    CGFloat w = self.itemWidth;</span><br><span class="line">    CGFloat h = [self.itemHeights[indexPath.item] floatValue];</span><br><span class="line">    CGFloat x = self.insets.left + self.minIndex * (w + self.columnGap);</span><br><span class="line">    CGFloat y = self.minHeight + self.rowGap;</span><br><span class="line">    attrs.frame = CGRectMake(x, y, w, h);</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 注：1.cell的宽度和高度算起来比较简单 : 宽度固定(itemWidth已经算好)，高度由外部传进来</span><br><span class="line">     *    2.cell的x : minIndex最短列作为当前列。</span><br><span class="line">     *    3.cell的y : minHeight最短列的高度，也就是最低高度，作为当前cell的起始y，当然要加上行之间的间隙。</span><br><span class="line">     */</span><br><span class="line">    </span><br><span class="line">    // 更新数组中的最大高度</span><br><span class="line">    self.columnsHeights[self.minIndex] = @(CGRectGetMaxY(attrs.frame));</span><br><span class="line">    NSLog(@&quot;%@&quot;,NSStringFromCGRect(attrs.frame));</span><br><span class="line">    [self.itemAttributes addObject:attrs];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  返回collectionView的尺寸</span><br><span class="line"> */</span><br><span class="line">- (CGSize)collectionViewContentSize &#123;</span><br><span class="line">    CGFloat height;</span><br><span class="line">    if (self.type == HorizontalType) &#123;</span><br><span class="line">        CGFloat rowHeight = (self.rowHeight == 0) ? 100 : self.rowHeight;</span><br><span class="line">        height = self.insets.top + (self.maxRowIndex+1) * (rowHeight + self.rowGap);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        height = self.maxHeight;</span><br><span class="line">    &#125;</span><br><span class="line">    return CGSizeMake(self.collectionView.frame.size.width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  所有元素（比如cell、补充控件、装饰控件）的布局属性</span><br><span class="line"> */</span><br><span class="line">- (NSArray *)layoutAttributesForElementsInRect:(CGRect)rect</span><br><span class="line">&#123;</span><br><span class="line">    return self.itemAttributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>######3.1 直接在控制器里使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 设置布局</span><br><span class="line">DYTWaterflowLayout *layout = [[DYTWaterflowLayout alloc]init];</span><br><span class="line">layout.type = _type;</span><br><span class="line">// 设置相关属性(不设置的话也行，都有相关默认配置)</span><br><span class="line">layout.numberOfColumns = 3;</span><br><span class="line">layout.columnGap = 10;</span><br><span class="line">layout.rowGap = 10;</span><br><span class="line">layout.insets = UIEdgeInsetsMake(10, 10, 10, 10);</span><br><span class="line">layout.rowHeight = 100;</span><br><span class="line">self.collectionView.collectionViewLayout = self.waterflowLayout = layout;</span><br></pre></td></tr></table></figure></p>
<p>######3.2 (举例)垂直瀑布流时，SDWebImage获取图片block里的具体实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (weakSelf.heights.count &lt; weakSelf.allImageUrls.count) &#123;</span><br><span class="line">   // 根据图片原始比例 计算 当前图片的高度(宽度固定)</span><br><span class="line">   CGFloat scale = image.size.height / image.size.width;</span><br><span class="line">   CGFloat width = weakSelf.waterflowLayout.itemWidth;</span><br><span class="line">   CGFloat height = width * scale;</span><br><span class="line">   NSNumber *heightNum = [NSNumber numberWithFloat:height];</span><br><span class="line">   [weakSelf.heights addObject:heightNum];</span><br><span class="line">&#125;</span><br><span class="line">if (weakSelf.heights.count == weakSelf.allImageUrls.count) &#123;</span><br><span class="line">   // 赋值所有cell的高度数组itemHeights</span><br><span class="line">   weakSelf.waterflowLayout.itemHeights = weakSelf.heights;</span><br><span class="line">   [weakSelf.collectionView reloadData];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>######3.3 UICollectionViewDataSource中要注意的点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    CollectionViewCell *cell = [collectionView dequeueReusableCellWithReuseIdentifier:reuseIdentifier forIndexPath:indexPath];</span><br><span class="line">    cell.imageView.image = self.picImageArr[indexPath.item];</span><br><span class="line">    // 注：非常关键的一句，由于cell的复用，imageView的frame可能和cell对不上，需要重新设置。</span><br><span class="line">    cell.imageView.frame = cell.bounds;</span><br><span class="line">    cell.backgroundColor = [UIColor orangeColor];</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>#三、总结<br>1.瀑布流使用场景比较广泛，也是常用的技术之一，我也是又回顾了一遍，并且总结了整体的思路决定分享出来，结尾有demo，童鞋们可以自行下载。另外我参考的资料链接也会贴出，供大家研究比对。<br>2.水平瀑布流还没达到百度图片搜索的那种效果，右边距离屏幕间隙太大了，所以影响美观。后续会继续研究，期待有所突破。<br>3.有种情况是后台直接给图片的所有数据给我们，包括url、图片宽高等等，其实这样就是后台已经做好了图片的顺序优化处理。不过我们可以自己研究一下这个排序思路。如何达到右边间隙几乎相同，比如都为10。<br>4.当然有疑惑的地方可以留言或者直接私信我，我们可以一起讨论。</p>
<p>#四、总结最终实现效果:<br><img src="https://upload-images.jianshu.io/upload_images/1869467-5b6da2338f3afe16.gif?imageMogr2/auto-orient/strip" alt="瀑布流.gif"></p>
<p>本文章demo：<br><a href="https://github.com/DaiYongTao/DYTWaterflowLayoutDemo" target="_blank" rel="noopener">瀑布流Demo</a><br>参考相关文章：<br><a href="https://www.jianshu.com/p/826a43d28a39" target="_blank" rel="noopener">iOS–瀑布流的实现</a>  – <a href="/u/12c258ba8408">作者Go_Spec</a><br><a href="https://www.jianshu.com/p/78830bdb04a9" target="_blank" rel="noopener">iOS 瀑布流基本实现</a>  – <a href="/u/19f68e4b47ce">作者iOS_成才录</a></p>
<blockquote>
<p>额。。。如果想知道图片里的小姐姐是谁，请直接在文章下面留言。因为我想暂时留点悬念给大家。(皮一下就很开心😄)</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/22/iOS随笔/UITableViewCell的高度自适应浅析/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/22/iOS随笔/UITableViewCell的高度自适应浅析/" class="post-title-link" itemprop="url">UITableViewCell的高度自适应浅析</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-22 14:12:12" itemprop="dateCreated datePublished" datetime="2018-05-22T14:12:12+08:00">2018-05-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:58:28" itemprop="dateModified" datetime="2018-12-26T14:58:28+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>—开篇：在我们开发中经常会用到UITableView, TableView上面的cell有时候非常复杂，高度可变、结构可变等等。那么这个时候我们该如何去自适应cell的高度呢。</p>
<p>#一.通过frame去计算</p>
<blockquote>
<p>第一种大家比较容易想到的方法，就是由上往下依次计算控件的frame，再将最下面的控件frame的最大y值拿到，赋值给整个cell_height，得到整个cell的最终高度。</p>
</blockquote>
<p>简单布局的就可直接计算，但，如果复杂一些，结构多变，就需要另外创建一个frameModel来专门计算和存储cell的frame。这种情况逻辑复杂，也比较容易出错。</p>
<p>######需要创建两个模型：model(存储数据)、frameModel(存储cell上子view的frame)</p>
<p>两者间的关系：frameModel是通过model来进行设置的，通过传入的model中的属性，来判断cell中子view显示或隐藏，从而一步一步得到所有的子view的frame值，最后，将cell的高度保存起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// model.h</span><br><span class="line">@interface Model : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *name; //昵称</span><br><span class="line">@property (nonatomic, copy) NSString *icon; //头像</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// FrameModel.h</span><br><span class="line">@class Model;</span><br><span class="line">@interface FrameModel : NSObject</span><br><span class="line"></span><br><span class="line">/** 数据模型 */</span><br><span class="line">@property (nonatomic, strong) Model *model;</span><br><span class="line">/** 头像frame */</span><br><span class="line">@property (nonatomic, assign, readonly) CGRect iconViewF;</span><br><span class="line">/** 昵称frame */</span><br><span class="line">@property (nonatomic, assign, readonly) CGRect nameLabelF;</span><br><span class="line"></span><br><span class="line">/** cell的高度 */</span><br><span class="line">@property (nonatomic, assign, readonly) CGFloat cellHeight;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// FrameModel.m</span><br><span class="line">- (void)setModel:(Model *)model &#123;</span><br><span class="line">    </span><br><span class="line">    _model = model;</span><br><span class="line">    </span><br><span class="line">    CGFloat screen_Width = [UIScreen mainScreen].bounds.size.width;</span><br><span class="line">    </span><br><span class="line">    // cell的宽度</span><br><span class="line">    CGFloat cellW = screen_Width;</span><br><span class="line"></span><br><span class="line">    // cell的边框宽度</span><br><span class="line">    CGFloat cellBorderW = 10;</span><br><span class="line">    // cell之间的间距</span><br><span class="line">    CGFloat cellBorderMargin = 15;</span><br><span class="line">    </span><br><span class="line">    // 1.头像</span><br><span class="line">    CGFloat iconWH = 35;</span><br><span class="line">    CGFloat iconX = cellBorderW;</span><br><span class="line">    CGFloat iconY = cellBorderW;</span><br><span class="line">    _iconViewF = CGRectMake(iconX, iconY, iconWH, iconWH);</span><br><span class="line">    </span><br><span class="line">    // 2.昵称</span><br><span class="line">    CGFloat nameX = CGRectGetMaxX(self.iconViewF) + cellBorderW;</span><br><span class="line">    CGFloat nameY = iconY;</span><br><span class="line">    CGSize nameSize = [model.name sizeWithFont:[UIFont systemFontOfSize:15]];</span><br><span class="line">    _nameLabelF = (CGRect)&#123;&#123;nameX,nameY&#125;,nameSize&#125;;</span><br><span class="line">    </span><br><span class="line">    // 13.cell的宽度</span><br><span class="line">    _cellHeight = CGRectGetMaxY(self.nameLabelF) + cellBorderMargin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// cell.h</span><br><span class="line">@class FrameModel;</span><br><span class="line">@interface Cell : UITableViewCell</span><br><span class="line"></span><br><span class="line">+ (Cell *)cellWithTableView:(UITableView *)tableView;</span><br><span class="line">/** frame模型 */</span><br><span class="line">@property (nonatomic, strong) FrameModel *frameModel;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// cell.m</span><br><span class="line">- (void)setFrameModel:(FrameModel *)frameModel &#123;</span><br><span class="line">    </span><br><span class="line">    _frameModel = frameModel;</span><br><span class="line">    </span><br><span class="line">    Model *model = frameModel.model;</span><br><span class="line">    // 头像</span><br><span class="line">    self.iconView.frame = frameModel.iconViewF;</span><br><span class="line">    [self.iconView sd_setImageWithURL:[NSURL URLWithString:model.icon]];</span><br><span class="line">    </span><br><span class="line">    // 昵称</span><br><span class="line">    self.nameLabel.frame = frameModel.nameLabelF;</span><br><span class="line">    self.nameLabel.text = model.name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一步步走下来应该非常直观的。<br>最后也就只有一步了，将拿到的数据进行model和frameModel之间的转换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  将Model模型转为FrameModel模型</span><br><span class="line"> */</span><br><span class="line">- (NSArray *)frameModelsWithStatuses:(NSArray *)models &#123;</span><br><span class="line">    </span><br><span class="line">    NSMutableArray *frames = [NSMutableArray array];</span><br><span class="line">    for (Model *model in models) &#123;</span><br><span class="line">        FrameModel *frame = [[FrameModel alloc] init];</span><br><span class="line">        frame.model = model;</span><br><span class="line">        [frames addObject:frame];</span><br><span class="line">    &#125;</span><br><span class="line">    return frames;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来就是数据展示咯，将frameModel导入进cell里面就OK了。</p>
<p>这其实是一种分离思路，将各个模块分离化，逻辑会清晰很多，对于复杂的数据和UI异常适合。</p>
<p>额，其中有一个sizeWithFont，是我创建的一个分类，只是为了简化代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// NSString+Extension.m</span><br><span class="line">- (CGSize)sizeWithFont:(UIFont *)font maxW:(CGFloat)maxW &#123;</span><br><span class="line">    NSMutableDictionary *attrs = [NSMutableDictionary dictionary];</span><br><span class="line">    attrs[NSFontAttributeName] = font;</span><br><span class="line">    CGSize maxSize = CGSizeMake(maxW, MAXFLOAT);</span><br><span class="line">    NSString *version = [UIDevice currentDevice].systemVersion;</span><br><span class="line">    if ([version doubleValue] &gt; 7.0) &#123;</span><br><span class="line">        return [self boundingRectWithSize:maxSize options:NSStringDrawingUsesLineFragmentOrigin attributes:attrs context:nil].size;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return [self sizeWithFont:font constrainedToSize:maxSize];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGSize)sizeWithFont:(UIFont *)font &#123;</span><br><span class="line">    return [self sizeWithFont:font maxW:MAXFLOAT];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>#二.通过自动布局自动适配（推荐使用）<br>1.在cell中，setModel方法中所做的事情只是将数据导入view中进行展示，其他都不用管。label的话需要设定preferredMaxLayoutWidth属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// cell.m</span><br><span class="line">- (void)setModel:(Model *)model &#123;</span><br><span class="line">    _model = model;</span><br><span class="line">    </span><br><span class="line">    // 头像</span><br><span class="line">    [self.iconView sd_setImageWithURL:[NSURL URLWithString:model.icon]];</span><br><span class="line">    // 昵称</span><br><span class="line">    self.nameLabel.text = model.name;    </span><br><span class="line">    CGFloat screen_Width = [UIScreen mainScreen].bounds.size.width;</span><br><span class="line">    CGFloat width = screen_Width - 35 - 5; // label的宽度</span><br><span class="line">    // 自动布局：设定label文字的最大宽度,这个宽度也可以通过外部进行传递，从而设定。</span><br><span class="line">    self.nameLabel.preferredMaxLayoutWidth = width;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.在获取cellHeight代理方法中，因为可能无法获取到当前的cell，我们的目的只是要得到cell的高度，所以在这我们创建了一个临时变量cell，用来计算cellHeight。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</span><br><span class="line">    self.cell.nameLabel.text = nil;</span><br><span class="line">    self.cell.model = self.models[indexPath.row];</span><br><span class="line">    // cell进行自动布局，可以得到cellHeight</span><br><span class="line">    CGFloat cellHeight = [self.cell.contentView systemLayoutSizeFittingSize:UILayoutFittingCompressedSize].height+1;</span><br><span class="line">    return cellHeight&gt;31.0f? cellHeight:31.0f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>后记：如果有些需求是想得到tableview最大的高度，让cell完全展示出来，可以监听tableView的contentSize属性。<br>注：iOS10以下，监听contentSize属性；iOS10及以上监听scrollView.contentSize属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">float iOS_version = [[[UIDevice currentDevice] systemVersion] floatValue];</span><br><span class="line">if (iOS_version &gt;= 8.0 &amp;&amp; iOS_version &lt; 10.0) &#123;</span><br><span class="line">    [self.tableView addObserver:self forKeyPath:@&quot;contentSize&quot; options:NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew context:nil];</span><br><span class="line">&#125;else if (iOS_version &gt;= 10.0) &#123;</span><br><span class="line">    [self.tableView addObserver:self forKeyPath:@&quot;scrollView.contentSize&quot; options:NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew context:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context &#123;</span><br><span class="line">    </span><br><span class="line">    float iOS_version = [[[UIDevice currentDevice] systemVersion] floatValue];</span><br><span class="line">    if (iOS_version &gt;= 8.0 &amp;&amp; iOS_version &lt; 10.0) &#123;</span><br><span class="line">        if ([keyPath isEqualToString:@&quot;contentSize&quot;] &amp;&amp; object == self.tableView) &#123;</span><br><span class="line">            CGSize size = [[change objectForKey:@&quot;new&quot;] CGSizeValue];</span><br><span class="line">            CGFloat height = size.height; //得到tableview的高度。</span><br><span class="line">            if(self.viewHeightBlock)&#123;</span><br><span class="line">                self.viewHeightBlock(height);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else if (iOS_version &gt;= 10.0) &#123;</span><br><span class="line">        if ([keyPath isEqualToString:@&quot;scrollView.contentSize&quot;] &amp;&amp; object == self.tableView) &#123;</span><br><span class="line">            CGSize size = [[change objectForKey:@&quot;new&quot;] CGSizeValue];</span><br><span class="line">            CGFloat height = size.height;</span><br><span class="line">            if(self.viewHeightBlock)&#123;</span><br><span class="line">                self.viewHeightBlock(height);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到这里，或许你挥一挥衣袖，只留下了一个赞。😄</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/19/iOS随笔/APP基础功能的配置管理之系统权限控制/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/19/iOS随笔/APP基础功能的配置管理之系统权限控制/" class="post-title-link" itemprop="url">APP基础功能的配置管理之系统权限控制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-19 16:22:12" itemprop="dateCreated datePublished" datetime="2018-04-19T16:22:12+08:00">2018-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:52:53" itemprop="dateModified" datetime="2018-12-26T14:52:53+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开篇：在iOS系统上，对于系统权限、用户权限的审核是非常严格的。<br>比如相机、相册、麦克风、通讯录、定位和蓝牙等，在app线上审核时，如果你没用到其中的权限，但是在info.plist里设置了，就会被拒。</p>
<blockquote>
<p>所以接下来，我整理了目前版本的Xcode(9.2)里所有的权限控制及解释</p>
</blockquote>
<p>NSBluetoothPeripheralUsageDescription — 访问蓝牙<br>NSCalendarsUsageDescription — 访问日历<br>NSCameraUsageDescription — 访问相机<br>NSContactsUsageDescription — 访问通讯录<br>NSFaceIDUsageDescription — 访问FaceID，面部识别<br>NSHealthShareUsageDescription — 访问健康分享<br>NSHealthUpdateUsageDescription — 访问健康更新<br>NSHomeKitUsageDescription — 访问智能家居</p>
<p>NSLocationAlwaysAndWhenInUseUsageDescription — 在使用期间始终访问位置<br>NSLocationWhenInUseUsageDescription — 在使用期间访问位置<br>NSLocationAlwaysUsageDescription — 始终访问位置<br>NSLocationUsageDescription — 访问位置</p>
<p>NSAppleMusicUsageDescription — 访问媒体资料库 — Privacy - Media Library Usage Description（key和描述不太一样）</p>
<p>NSMicrophoneUsageDescription — 麦克风<br>NSMotionUsageDescription — 运动使用权限<br>kTCCServiceMediaLibrary —  访问音乐权限 — Privacy - Music Usage Description（key和描述不太一样）<br>NFCReaderUsageDescription — NFC权限 — Privacy - NFC Scan Usage Description（key和描述不太一样）</p>
<p>NSPhotoLibraryAddUsageDescription — 添加内容到相册 — Privacy - Photo Library Additions Usage Description（key和描述不太一样）<br>NSPhotoLibraryUsageDescription — 访问相册</p>
<p>NSRemindersUsageDescription — 访问提醒事项<br>NSSiriUsageDescription — 访问Siri<br>NSSpeechRecognitionUsageDescription — 语音识别</p>
<p>NSVideoSubscriberAccountUsageDescription — 电视供应商使用权限<br>Privacy - TV Provider Usage Description 、<br>Privacy - Video Subscriber Account Usage Description<br>最后两项是相同的。</p>
<blockquote>
<p>注：到目前为止一共是24项，但是最后两项是相同的，有一个被弃用了，所以只有23项。</p>
</blockquote>
<p>相关文章：<br><a href="https://www.jianshu.com/p/6d474abbf97e" target="_blank" rel="noopener">APP基础功能的配置管理之ATS</a><br><a href="https://www.jianshu.com/p/928618d1c831" target="_blank" rel="noopener">APP基础功能的配置管理之URL Scheme和白名单</a><br><a href="https://www.jianshu.com/p/733288fc6fdb" target="_blank" rel="noopener">APP基础功能的配置管理之屏幕旋转控制</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/19/iOS随笔/APP基础功能的配置管理之屏幕旋转控制/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/19/iOS随笔/APP基础功能的配置管理之屏幕旋转控制/" class="post-title-link" itemprop="url">APP基础功能的配置管理之屏幕旋转控制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-19 16:06:12" itemprop="dateCreated datePublished" datetime="2018-04-19T16:06:12+08:00">2018-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:52:17" itemprop="dateModified" datetime="2018-12-26T14:52:17+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前言：<br>1.屏幕分为：横竖屏。<br>2.在苹果系统中，分为4个类型：Portrait(竖直正方向)、Upside Down(竖直倒转方向)、 LandscapeLeft(左)、LandscapeRight(右)<br>一般情况下，我们创建一个app，系统默认选择的是1、3、4方向，倒转方向用的很少，如果需要使用2方向，即竖直倒转方向，除了info.plist设置之外，还需在视图控制器里设置shouldAutorotate为NO;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 是否默认旋转</span><br><span class="line">- (BOOL)shouldAutorotate &#123;</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>横屏用的地方也比较多，比如视频app从竖屏切到横屏全屏观看模式，再比如某些app的横屏页面板块。这就需要进行页面的横屏设置了。</p>
<blockquote>
<p>这里还涉及到一个跳转问题，iOS页面跳转分为模态视图跳转Modal Presentation和通过导航栏的跳转</p>
</blockquote>
<p>######1.通过模态视图跳转，只需要在destination控制器里加上以下代码配置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)shouldAutorotate &#123;</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br><span class="line">- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation &#123;</span><br><span class="line">    return toInterfaceOrientation == UIInterfaceOrientationLandscapeRight;</span><br><span class="line">&#125;</span><br><span class="line">- (UIInterfaceOrientation)preferredInterfaceOrientationForPresentation &#123;</span><br><span class="line">    return UIInterfaceOrientationLandscapeRight;</span><br><span class="line">&#125;</span><br><span class="line">- (UIInterfaceOrientationMask)supportedInterfaceOrientations &#123;</span><br><span class="line">    return UIInterfaceOrientationMaskLandscapeRight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>######2.通过导航栏的跳转push到下个控制器</p>
<p>在Appdelegate.h里添加外部属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(nonatomic,assign)BOOL allowRotation; //是否允许转向</span><br></pre></td></tr></table></figure></p>
<p>在Appdelegate.m里设定整个app的Orientation属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (UIInterfaceOrientationMask)application:(UIApplication *)application supportedInterfaceOrientationsForWindow:(nullable UIWindow *)window &#123;</span><br><span class="line">    </span><br><span class="line">    if (self.allowRotation == YES) &#123;</span><br><span class="line">        //横屏</span><br><span class="line">        return UIInterfaceOrientationMaskLandscape;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        //竖屏</span><br><span class="line">        return UIInterfaceOrientationMaskPortrait;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在目标控制器里，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AppDelegate * appDelegate = (AppDelegate *)[UIApplication sharedApplication].delegate;</span><br><span class="line">//允许转成横屏</span><br><span class="line">appDelegate.allowRotation = YES;</span><br><span class="line">//调用横屏代码</span><br><span class="line">[UIDevice switchNewOrientation:UIInterfaceOrientationLandscapeRight]; //设定切换模式，如果在手机里取消了屏幕旋转锁定，那么横屏时就会根据手机的放置方向而自动旋转。</span><br></pre></td></tr></table></figure></p>
<p>相关文章：<br><a href="https://www.jianshu.com/p/6d474abbf97e" target="_blank" rel="noopener">APP基础功能的配置管理之ATS</a><br><a href="https://www.jianshu.com/p/928618d1c831" target="_blank" rel="noopener">APP基础功能的配置管理之URL Scheme和白名单</a><br><a href="https://www.jianshu.com/p/1d91b09a12d8" target="_blank" rel="noopener">APP基础功能的配置管理之系统权限控制</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/19/iOS随笔/APP基础功能的配置管理之URL-Scheme和白名单/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/19/iOS随笔/APP基础功能的配置管理之URL-Scheme和白名单/" class="post-title-link" itemprop="url">APP基础功能的配置管理之URL Scheme和白名单</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-19 15:38:12" itemprop="dateCreated datePublished" datetime="2018-04-19T15:38:12+08:00">2018-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:54:28" itemprop="dateModified" datetime="2018-12-26T14:54:28+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##一、URL Scheme<br>相信大家都知道 URL，例如 <a href="https://www.jianshu.com/" target="_blank" rel="noopener">http://www.jianshu.com/</a>就是一个URL。在 :// 之前的部分就称为 URL Scheme。<br>也就是说 <a href="https://www.jianshu.com/" target="_blank" rel="noopener">http://www.jianshu.com/</a> 的 URL Scheme 就是 http </p>
<blockquote>
<p>URL Scheme 就是一个可以让 app 相互之间可以跳转的协议</p>
</blockquote>
<p>1.打开Mail<br>[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@”mailto:<a href="mailto:frank@wwdcdemo.example.com" target="_blank" rel="noopener">frank@wwdcdemo.example.com</a>“]]</p>
<p>2.打开电话<br>[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@”tel:10086”]];</p>
<p>3.打开SMS<br>[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@”sms:10086”]];</p>
<p>4.通过自定义 <strong>URL Scheme</strong> 向应用传递参数<br>举例：支付宝的<strong>URL Scheme</strong> ：<a href="alipay2018081200218976://safepay/?" target="_blank" rel="noopener">alipay2018081200218976://safepay/?</a>{“memo”:{“result”:””,”ResultStatus”:”6001”,”memo”:”用户中途取消”},”requestType”:”safepay”}</p>
<p>##二、白名单</p>
<p>######1.实际项目里用到的常见白名单。<br><img src="https://upload-images.jianshu.io/upload_images/1869467-a086db78de75397a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="常见白名单.png"></p>
<p>######2.自定义白名单。<br>白名单一般是和URL Scheme结合使用的。<br>比如app_A想打开app_B，app_B的URL Schemes是haha。<img src="https://upload-images.jianshu.io/upload_images/1869467-e9d3d2ce34559e61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自定义白名单1.png"></p>
<p>我们就需要在app_A里的info.plist添加白名单。<img src="https://upload-images.jianshu.io/upload_images/1869467-612ce6828e28f37e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自定义白名单2.png"></p>
<p>废话不多说，直接上代码（app_A里写）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)clickBtn &#123;</span><br><span class="line">    </span><br><span class="line">    NSString *urlString = @&quot;haha://&quot;;</span><br><span class="line">    // 若有中文传输需要进行转义</span><br><span class="line">    NSString *customURL = [urlString stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]];</span><br><span class="line">    // 检查自定义 URL 是否被定义，如果定义了，则使用 shared application 实例来打开 URL</span><br><span class="line">    if ([[UIApplication sharedApplication] canOpenURL:[NSURL URLWithString:customURL]]) &#123;</span><br><span class="line">        // openURL: 方法启动应用并将 URL 传入应用，在此过程中，当前的应用进入后台</span><br><span class="line">        [[UIApplication sharedApplication] openURL:[NSURL URLWithString:customURL]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@&quot;URL error&quot; message:[NSString stringWithFormat:@&quot;No custom URL defined for %@&quot;, customURL] delegate:self cancelButtonTitle:@&quot;Ok&quot; otherButtonTitles:nil];</span><br><span class="line">        [alert show];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">后记：</span><br><span class="line">1.每个app的 URL Scheme 都是不一样的，如果存在一样的 URL Scheme，那么系统就会响应先安装那个app的 URL Scheme，因为后安装的app的 URL Scheme 被覆盖掉了，是不能被调用的。</span><br><span class="line">2.所以这里存在一个漏洞。比如app_A想打开app_B，但是app_C的 URL Scheme和app_B的一样，而且它比app_B先安装。那就永远调不起app_B，除非将app_C卸载。</span><br><span class="line">3.所以自己公司的URLScheme取名时尽量复杂些，这样别人想调起你app的难度就大大增加了。</span><br></pre></td></tr></table></figure>
<p>相关文章：<br><a href="https://www.jianshu.com/p/6d474abbf97e" target="_blank" rel="noopener">APP基础功能的配置管理之ATS</a><br><a href="https://www.jianshu.com/p/733288fc6fdb" target="_blank" rel="noopener">APP基础功能的配置管理之屏幕旋转控制</a><br><a href="https://www.jianshu.com/p/1d91b09a12d8" target="_blank" rel="noopener">APP基础功能的配置管理之系统权限控制</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/19/iOS随笔/APP基础功能的配置管理之ATS/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/19/iOS随笔/APP基础功能的配置管理之ATS/" class="post-title-link" itemprop="url">APP基础功能的配置管理之ATS</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-19 14:43:12" itemprop="dateCreated datePublished" datetime="2018-04-19T14:43:12+08:00">2018-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:53:39" itemprop="dateModified" datetime="2018-12-26T14:53:39+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##一、TLS的历史</p>
<blockquote>
<p>1994年，NetScape公司设计了SSL协议（Secure Sockets Layer）的1.0版，但是未发布。<br>1995年，NetScape公司发布SSL 2.0版，很快发现有严重漏洞。<br>1996年，SSL 3.0版问世，得到大规模应用。<br>1999年，互联网标准化组织ISOC接替NetScape公司，发布了SSL的升级版<a href="http://en.wikipedia.org/wiki/Secure_Sockets_Layer" target="_blank" rel="noopener">TLS</a>（Transport Layer Security） 1.0版。<br>2006年和2008年，TLS进行了两次升级，分别为TLS 1.1版和TLS 1.2版。最新的变动是2011年TLS 1.2的<a href="http://tools.ietf.org/html/rfc6176" target="_blank" rel="noopener">修订版</a>。</p>
</blockquote>
<p>##二、Xcode中info.plist相关字段含义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">	&lt;key&gt;NSAllowsArbitraryLoadsInMedia&lt;/key&gt;</span><br><span class="line">	&lt;false/&gt;</span><br><span class="line">	&lt;key&gt;NSAllowsLocalNetworking&lt;/key&gt;</span><br><span class="line">	&lt;false/&gt;</span><br><span class="line">	&lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</span><br><span class="line">	&lt;false/&gt;</span><br><span class="line">	&lt;key&gt;NSAllowsArbitraryLoadsInWebContent&lt;/key&gt;</span><br><span class="line">	&lt;false/&gt;</span><br><span class="line">	&lt;key&gt;NSExceptionDomains&lt;/key&gt;</span><br><span class="line">	&lt;dict&gt;</span><br><span class="line">		&lt;key&gt;www.app.youCompany.cn&lt;/key&gt;</span><br><span class="line">		&lt;dict&gt;</span><br><span class="line">			&lt;key&gt;NSIncludesSubdomains&lt;/key&gt;</span><br><span class="line">			&lt;true/&gt;</span><br><span class="line">			&lt;key&gt;NSExceptionAllowsInsecureHTTPLoads&lt;/key&gt;</span><br><span class="line">			&lt;true/&gt;</span><br><span class="line">			&lt;key&gt;NSExceptionMinimumTLSVersion&lt;/key&gt;</span><br><span class="line">			&lt;true/&gt;</span><br><span class="line">			&lt;key&gt;NSExceptionRequiresForwardSecrecy&lt;/key&gt;</span><br><span class="line">			&lt;true/&gt;</span><br><span class="line">			&lt;key&gt;NSRequiresCertificateTransparency&lt;/key&gt;</span><br><span class="line">			&lt;true/&gt;</span><br><span class="line">		&lt;/dict&gt;</span><br><span class="line">	&lt;/dict&gt;</span><br><span class="line">&lt;/dict&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>NSAllowsArbitraryLoads ：   默认为NO。如果设置为YES，将解除ATS限制，将会引发苹果的审查。一般设置为NO，然后通过下面的NSExceptionDomains去添加白名单（或者叫例外）。</p>
</blockquote>
<blockquote>
<p>NSAllowsArbitraryLoadsInMedia ：  默认为NO。如果设置为YES，将解除AVFoundation访问媒体内容时的ATS限制。</p>
</blockquote>
<blockquote>
<p>NSAllowsArbitraryLoadsInWebContent ：  默认为NO。如果设置为YES，将解除网页访问时的ATS限制。</p>
</blockquote>
<blockquote>
<p>NSAllowsLocalNetworking：  默认为NO。如果设置为YES，将解除访问本地资源时的ATS限制。</p>
</blockquote>
<blockquote>
<p>NSExceptionDomains : 添加例外</p>
</blockquote>
<blockquote>
<p>NSIncludesSubdomains ： 默认为NO。如果设置为YES，当前域名的 ATS 策略适用于其所有子域名。</p>
</blockquote>
<blockquote>
<p>NSExceptionAllowsInsecureHTTPLoads：  默认为NO。如果设置为YES，可以同时通过 HTTP 和 HTTPS 访问当前域名。（将会引发苹果的审查，上线时需要说明原因）</p>
</blockquote>
<blockquote>
<p>NSExceptionMinimumTLSVersion： string类型，可以设置 TLS 最低版本。（因为低版本有安全漏洞，将会引发苹果的审查，上线时需要说明原因）</p>
</blockquote>
<blockquote>
<p>NSExceptionRequiresForwardSecrecy：  默认为YES。如果设置为NO，允许针对当前域名使用不支持正向保密的 TLS 加密算法。</p>
</blockquote>
<blockquote>
<p>NSRequiresCertificateTransparency：  默认为NO。如果设置为YES，将验证域名服务器证书的Certificate Transparency时间戳 。</p>
</blockquote>
<p>提交审核说明(举例)：</p>
<ul>
<li>必须连接由其他机构控制的服务器，其还不支持安全连接。</li>
<li>必须通过 web 展示来源不一的各种网络内容，但又不能完全使用NSAllowsArbitraryLoadsInWebContent所管理的类。</li>
<li>必须支持那些还未升级至可使用安全连接，不得不通过公共域名访问网络的设备。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后记：因最近公司需要我们整理一些自己在工作中用到的基础知识，特此整理搜集了一些笔记，放入简书供大家学习探讨。</span><br></pre></td></tr></table></figure>
<p>相关文章：<br><a href="https://www.jianshu.com/p/928618d1c831" target="_blank" rel="noopener">APP基础功能的配置管理之URL Scheme和白名单</a><br><a href="https://www.jianshu.com/p/733288fc6fdb" target="_blank" rel="noopener">APP基础功能的配置管理之屏幕旋转控制</a><br><a href="https://www.jianshu.com/p/1d91b09a12d8" target="_blank" rel="noopener">APP基础功能的配置管理之系统权限控制</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/31/iOS随笔/QBImagePickerController导航栏的设置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/31/iOS随笔/QBImagePickerController导航栏的设置/" class="post-title-link" itemprop="url">QBImagePickerController导航栏的设置</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-31 11:01:12" itemprop="dateCreated datePublished" datetime="2018-01-31T11:01:12+08:00">2018-01-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:57:18" itemprop="dateModified" datetime="2018-12-26T14:57:18+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开篇：想必大家对QBImagePickerController是非常熟悉的吧，至于怎么用很简答，网上、简书上有各位大神说的很详细。<br>在此，我要说一个小知识，一不小心，思考方向走错了，可能会花上一两个小时哦。</p>
<p>##一、我的困惑</p>
<blockquote>
<p>1.它是否有导航栏，熟悉的同学都知道我们跳转QBImagePickerController时，都是直接present，是模态视图之间的跳转，而并不是push过去的。而且我们看到的QBImagePickerController的导航栏都是透明的。那么，我们就会考虑，它是否真的有导航栏呢。</p>
</blockquote>
<p>验证我的想法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.[imagePickerController.navigationController.navigationBar setBackgroundColor:[UIColor redColor]];</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.imagePickerController.view.backgroundColor = [UIColor redColor];</span><br></pre></td></tr></table></figure>
<p>通过上面的两种方法都毫无效果，使我更加走进了一个误区，我认定QBImagePickerController没有导航栏。那么我猜想他头部的控件该是自定义的了，应该要暴露设置的参数给我，可惜我找了几遍，都没有。</p>
<p>##二、刨根问底，直接进入pod里面的QBImagePickerController目录下<br><img src="http://upload-images.jianshu.io/upload_images/1869467-9193df32d1a7979c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="storyboard.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1869467-846837bf8cd16dcf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置.png"></p>
<p>一看之下，才知道QBImagePickerController确实有导航控制器，不过是系统的UINavigationController，导航栏的背景颜色为空。我直接将storyboard里的UINavigationController类改成我自定义的导航控制器。问题引刃而解。</p>
<p>结语：有时候我们思考问题会走弯路，写这篇小知识，是希望自己走过的弯路提前告诉大家，给碰到问题的同学一点小帮助。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/29/iOS随笔/UITableView代理和数据源调用的先后顺序规律探究/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/29/iOS随笔/UITableView代理和数据源调用的先后顺序规律探究/" class="post-title-link" itemprop="url">UITableView代理和数据源调用的先后顺序规律探究</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-29 18:41:12" itemprop="dateCreated datePublished" datetime="2018-01-29T18:41:12+08:00">2018-01-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-26 14:57:54" itemprop="dateModified" datetime="2018-12-26T14:57:54+08:00">2018-12-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/iOS随笔/" itemprop="url" rel="index"><span itemprop="name">iOS随笔</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开篇：因为某些原因和朋友讨论到，tableView在不同的iOS版本中，调用的先后顺序有所不同。特此，我利用相同的代码，在三种版本的模拟器中运行，果然得出了一些特定的规律。</p>
<p>我设置的数据源有1个section、30行，屏幕完全显示为22行。</p>
<p>####iOS11.0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">numberOfSectionsInTableView</span><br><span class="line">heightForHeaderInSection</span><br><span class="line">heightForFooterInSection		（这四个方法一共调用三次，顺序和此列表显示一样）</span><br><span class="line">numberOfRowsInSection</span><br><span class="line"></span><br><span class="line">cellForRowAtIndexPath </span><br><span class="line">heightForRowAtIndexPath </span><br><span class="line">….</span><br><span class="line">….	  (22-5 = 17行)</span><br><span class="line">heightForHeaderInSection</span><br><span class="line">heightForFooterInSection		（在倒数第五行，经测试5是固定的值）</span><br><span class="line">…. 	 </span><br><span class="line">cellForRowAtIndexPath </span><br><span class="line">heightForRowAtIndexPath         （剩余的5行，和上面的17行是相同的）</span><br><span class="line">….</span><br></pre></td></tr></table></figure></p>
<p>####iOS9.0、iOS10.0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">这些方法一共调用三次，顺序和此列表显示一样</span><br><span class="line">numberOfSectionsInTableView</span><br><span class="line">heightForHeaderInSection</span><br><span class="line">heightForHeaderInSection</span><br><span class="line">heightForFooterInSection</span><br><span class="line">heightForFooterInSection</span><br><span class="line">numberOfRowsInSection</span><br><span class="line"></span><br><span class="line">heightForRowAtIndexPath</span><br><span class="line">….</span><br><span class="line">….		(30行)</span><br><span class="line">….</span><br><span class="line"></span><br><span class="line">cellForRowAtIndexPath </span><br><span class="line">heightForRowAtIndexPath</span><br><span class="line">….</span><br><span class="line">….		(22行)</span><br><span class="line">….</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">注：</span><br><span class="line">iOS9.0、iOS10.0中</span><br><span class="line">就算以下两个方法都没有实现</span><br><span class="line">self.tableView.sectionHeaderHeight = 20;</span><br><span class="line">self.tableView.sectionFooterHeight = 20;</span><br><span class="line">heightForHeaderInSection和heightForFooterInSection都会调用</span><br><span class="line"></span><br><span class="line">iOS11.0中</span><br><span class="line">以下两个方法都没有实现</span><br><span class="line">self.tableView.sectionHeaderHeight = 20;</span><br><span class="line">self.tableView.sectionFooterHeight = 20;</span><br><span class="line">heightForHeaderInSection和heightForFooterInSection不会调用</span><br></pre></td></tr></table></figure>
<p>结语：iOS11.0之后对tableview的数据源调用有了很大改变，节省了很多调用成本。更加合理规范化。<br>所以如果有同学在获取不到数据源等等问题时，可以考虑本文所写的调用顺序，从而查找原因。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">64</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
